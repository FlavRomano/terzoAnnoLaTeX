[[1. Introduzione]]
# URI
Le API REST utilizzano gli URI (Uniform Resource Identifier) per indirizzare le risorse. Sul Web di oggi, i design degli URI vanno da capolavori che comunicano chiaramente il modello di risorsa dell'API come:
 `http://api.example.restapi.org/france/paris/louvre/leonardo-da-vinci/mona-lisa`
## Formato
Un URI generico segue una sintassi del tipo:
``URI = scheme "://" authority "/" path ["?" query] ["#" fragment]``
Abbiamo delle regole ben precise:
### Il forward slash separator  "/" deve essere usato per indicare una relazione gerarchica
Il carattere forward slash (/) viene utilizzato nella porzione di percorso dell'URI per indicare una relazione gerarchica tra le risorse. Tipo
```http://api.canvas.restapi.org/shapes/polygons/quadrilaterals/squares```

### Carattere slash "/" non deve essere inclusa negli URI
Le API REST non dovrebbero aspettarsi uno slash finale e non dovrebbero includerlo nei collegamenti forniti ai client.
Molti componenti e framework web tratteranno i due URI seguenti allo stesso modo:
``http://api.canvas.restapi.org/shapes/ http://api.canvas.restapi.org/shapes``
Tuttavia, ogni carattere all'interno di un URI conta per l'identità unica di una risorsa. Due URI diversi corrispondono a due risorse diverse. Se gli URI sono diversi, lo sono anche le fonti e viceversa. Pertanto, un'API REST deve generare e comunicare URI puliti e deve essere intollerante ai tentativi del client di identificare una risorsa in modo impreciso.

### Underscore "\_" non devono essere utilizzati negli URI.
## Archetipi delle risorse 
Quando modelliamo una risorsa dell'API, possiamo iniziare con gli *archetipi* base. Ci aiutano a comunicare in modo consistente le strutture e i comportamenti che si trovano comunemente nei progetti di API REST. Un'API REST è composta da quattro archetipi di risorse distinti:
	1. Document
	2. Collection
	3. Store
	4. Controller
### Document
Un risorsa document è simile a un'istanza di oggetto o a un record di database. La rappresentazione dello stato di un documento include tipicamente sia campi con valori che collegamenti ad altre risorse correlate. Con la sua struttura fondamentale basata su campi e collegamenti, il tipo document è l'archetipo concettuale di base degli altri archetipi di risorse. 
Infatti gli altri tre archetipi di risorse possono essere visti come specializzazioni dell'archetipo documento:
```
http://api.soccer.restapi.org/leagues/seattle http://api.soccer.restapi.org/leagues/seattle/teams/trebuchet http://api.soccer.restapi.org/leagues/seattle/teams/trebuchet/players/mike
```
Un documento può avere risorse figlie che rappresentano i suoi specifici concetti subordinati. Grazie alla sua capacità di riunire molti tipi di risorse diverse sotto un unico genitore, un documento è un candidato logico per la risorsa radice di un'API REST, nota anche come **docroot**. L'URI sotto identifica la docroot, che è il punto di ingresso dell'API REST soccer:
```http://api.soccer.restapi.org```
### Collection
Una risorsa collection è una directory di risorse gestita dal server. I clients possono proporre nuove risorse da aggiungere a una raccolta. Tuttavia, spetta alla collezione scegliere se creare o meno una nuova risorsa. Una risorsa collection sceglie ciò che vuole contenere e decide anche gli URI di ogni risorsa contenuta.
### Store
Uno store è un archivio di risorse gestito dal client. Una risorsa store concsente a un client API di inserire risorse, recuperarle e di decidere quando eliminarle. Di per sé, gli store non creano nuove risorse $\implies$ non generano mai nuovi URI.
Invece, ogni risorsa memorizzata ha un URI che è stato scelto da un client quando è stata inizialmente inserita nella store. Ad esempio, l'utente con ID 1234 di un programma client che utilizza un'API REST di calcio per inserire una risorsa document denominata `gabigol` nel suo store di calciatori preferiti.
``PUT /users/1234/favorites/gabigol``
### Controller
Una risorsa controller modella un concetto procedurale. Le risorse controller sono come funzioni eseguibili, con parametri e valori di ritorno, ingressi e uscite. Come un'applicazione web tradizionale utilizza i moduli HTML, un'API REST si affida alle risorse controller per eseguire azioni specifiche dell'applicazione che non possono essere logicamente mappate a uno dei metodi standard (CRUD: `create, retrieve, update, delete`). 
I nomi dei controller appaiono in genere come ultimo segmento del percorso URI, senza risorse figlie che li seguono nella gerarchia. Ad esempio 
`POST /alerts/1234/resend`
mostra un controller che consente ad un client di inviare nuovamente un avviso a un utente.
## Design path di un URI
Ogni segmento del percorso URI, separato da slash (/), rappresenta un'opportunità di design. L'assegnazione di valori significativi a ciascun segmento di percorso aiuta a comunicare chiaramente la struttura gerarchica del modello di risorse di un'API REST.![[Pasted image 20220629190638.png]]
### Usare sostantivi singolari per i document
Un URI che rappresenta una risorsa document deve essere denominato con un sostantivo singolare o con un segmento di percorso di una frase sostantiva.
Ad esempio, l'URI per un document di un singolo giocatore dovrebbe avere la forma singolare:
```http://api.soccer.restapi.org/leagues/seattle/teams/trebuchet/players/claudio```
### Usare sostantivi plurali per collections
Un URI che identifica una collection dovrebbe essere denominato con un nome plurale come segmento di percorso. Il nome di una raccolta deve essere scelto in modo da riflettere ciò che contiene in modo uniforme.
Ad esempio, l'URI per una raccolta di documenti di giocatori  usa la forma plurale del nome delle risorse contenute:
```http://api.soccer.restapi.org/leagues/seattle/teams/trebuchet/players```
### Usare sostantivi plurali per store
Un URI che identifica un archivio di risorse deve essere denominato con un sostantivo plurale, o una frase sostantiva, come segmento di percorso. L'URI di un archivio di playlist musicali può utilizzare la forma plurale come segue:
```http://api.music.restapi.org/artists/mikemassedotcom/playlists```
### Usare un verbo per i controller
Come una funzione di un programma, l'URI che identifica una risorsa controller deve avere un nome che ne indichi l'azione. Ad esempio:
```
http://api.college.restapi.org/students/morgan/register
http://api.build.restapi.org/qa/nightly/runTestSuite
```
### Segmenti di percorso variabili?
Alcuni segmenti di percorso URI sono statici, ovvero hanno nomi fissi che possono essere scelti dal progettista dell'API REST. Altri segmenti di percorso URI sono variabili, il che significa che vengono riempiti automaticamente con qualche identificatore che può aiutare a fornire all'URI la sua unicità. La sintassi dei modelli di URI consente ai progettisti di nominare chiaramente sia i segmenti statici che quelli variabili. Un modello URI include variabili che devono essere sostituite prima della risoluzione. L'esempio di modello URI riportato di seguito ha tre variabili (leagueId, teamId e playerId):
```http://api.soccer.restapi.org/leagues/{leagueId}/squadre/{teamId}/giocatori/{playerId}```
La sostituzione delle variabili di un modello URI può essere effettuata da un'API REST o dai suoi client. Ogni sostituzione può utilizzare un identificatore numerico o alfanumerico, come mostrato negli esempi seguenti:
```http://api.soccer.restapi.org/leagues/seattle/teams/trebuchet/players/21```
	In questo caso `21` occupa un segmento di percorso variabile chiamato `playerId`.

> I client di un'API REST devono considerare gli URI come gli unici identificatori di risorse significativi. Anche se altri identificatori del sistema di backend (come gli ID dei database) possono comparire nel percorso di un URI, sono privi di significato per il codice client. Stabilendo gli URI come unici ID, l'implementazione del backend di un'API REST può evolvere nel tempo senza impattare i client esistenti.
### Nomi di funzioni CRUD non dovrebbero stare nell'URI
Gli URI non devono essere utilizzati per indicare l'esecuzione di una funzione CRUD. Gli URI devono essere utilizzati per identificare in modo univoco le risorse e devono essere denominati come descritto nelle regole precedenti. 
I metodi di richiesta HTTP devono essere utilizzati per indicare quale funzione CRUD viene eseguita.
Ad esempio, è preferibile utilizzare questo tipo di interazione API:
```DELETE /users/1234```
rispetto a queste
```
GET /deleteUser/1234
DELETE /deleteUser/1234
```
## Design delle query
La query opzionale di un URI viene dopo il percorso e prima del frammento opzionale:
```URI = scheme "://" authority "/" path [ "?" query ] [ "#" fragment ]```
Come componente di un URI, la query contribuisce all'identificazione univoca di una fonte. Si consideri il seguente esempio:
```http://api.college.restapi.org/students/morgan/send-sms```
>L'URI di una risorsa controller che invia un messaggio sms.

```http://api.college.restapi.org/students/morgan/send-sms?text=hello```
>L'URI di una risorsa controller che invia un messaggio sms con il valore di testo hello.

La componente query di un URI contiene un insieme di parametri da interpretare come una variazione o un derivato della risorsa identificata gerarchicamente dalla componente path. Quindi, sebbene queste due risorse non siano la stessa cosa, sono strettamente correlate.
Il componente di interrogazione può fornire ai client ulteriori capacità di interazione, come la ricerca e il filtraggio ad hoc. Pertanto, a differenza degli altri elementi di un URI, la parte della query può essere trasparente al client di un'API REST.
L'intero URI di una risorsa deve essere trattato in modo opaco da intermediari di base basati sulla rete, come le cache HTTP. Le cache non devono variare il loro comportamento in base alla presenza o meno di una query in un determinato URI. In particolare, i messaggi di risposta non devono essere esclusi dalle cache solo in base alla presenza di una query nell'URI richiesto. Le intestazioni HTTP, e non le query, devono essere utilizzate per dirigere il comportamento di un intermediario della cache.
### La componente query di un URI può essere usata per filtrare collection o store
Il componente query di un URI si adatta naturalmente a fornire criteri di ricerca a una collection o a una store. Vediamo un esempio:
```GET /users```
>La rappresentazione di stato del messaggio di risposta contiene un elenco di tutti gli utenti della collection.

```GET /users?role=admin```
>La rappresentazione di stato del messaggio di risposta contiene un elenco filtrato di tutti gli utenti dell'insieme con il valore "role" di admin.

### La componente di query di un URI deve essere usata per impaginare collection o memorizzare i risultati
Un client API REST deve utilizzare il componente query per impaginare la collection e memorizzare i risultati con i parametri `pagesize` e `pageStartIndex`. Il primo specifica il numero massimo di elementi contenuti da restituire nella risposta. Il secondo specifica l'indice del primo elemento da restituire nella risposta. Ad esempio:
`GET /users?pageSize=25&pageStartIndex=50`
Quando la complessità dei requisiti di paginazione (o di filtraggio) di un client supera le semplici capacità di formattazione della parte di query, si può pensare di progettare una risorsa speciale del controller che collabori con una collection o una store. Ad esempio, il controller seguente può accettare input più complessi tramite il corpo dell'entità della richiesta, invece della parte di query dell'URI:
`POST /users/search`
Questo design consente di specificare facilmente nel corpo del messaggio di richiesta del client tipi di intervallo personalizzati e ordini speciali. Bisogna fare attenzione a garantire che i risultati memorizzabili nella cache del controllore siano contrassegnati di conseguenza.
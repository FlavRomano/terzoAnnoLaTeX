## A cosa serve?
Il diagramma delle attività si concentra sulla modellazione delle fasi di elaborazione procedurale di un sistema. Specifica il flusso di controllo e di dati tra i vari passaggi (le azioni) necessari per implementare un'attività. I diagrammi di attività consentono di definire le attività indipendentemente dagli oggetti, e.g è possibile modellare librerie di funzioni così come processi aziendali e organizzazioni del mondo reale.
Sono utilizzati in particolare per la modellazione dei processi aziendali e si sono dimostrati molto utili per i processi complessi.
## Attività
Un diagramma delle attività consente di specificare il comportamento richiesto dall'utente sotto forma di attività. Un'attività stessa può descrivere l'implementazione di un caso d'uso.
- A livello molto dettagliato, può anche definire il comportamento di un'operazione sotto forma di istruzioni individuali.
- A livello meno dettagliato può modellare le funzioni di un processo aziendale.

Il comortamento può quindi essere definito a diversi livelli di granularità. Un'attività può essere assegnata a un'operazione di una classe, ma può anche essere autonoma.

Il contenuto di un'attività è un DAG i cui nodi rappresentano i componenti dell'attività (e.g azioni, strutture dati, flusso di oggetti) cioè i possibili percorsi di esecuzione dell'attività.
- Un'attività è rappresentata come un rettangolo con gli angoli arrotondati e può, proprio come un'operazione, avere dei parametri. 
- I parametri sono rappresentati come rettangoli sovrapposti al confine dell'attività.
	- Solitamente i parametri input vengono posizionati sul bordo sinistro o superiore, mentre i parametri di output sul bordo destro o inferiore.
	- Ciò consente di leggere un'attività da sinistra verso destra o dall'alto verso il basso.
- I valori trasferiti all'attività tramite parametri di input sono disponibili per quelle azioni che sono collegate ad essi da un arco diretto.
- Allo stesso modo i parametri di output ricevono i loro valori tramite archi diretti dalle azioni all'interno dell'attività.

![[exAttivita.png]]

L'esempio mostra i passi necessari per l'esecuzione dell'attività Eseguire esame. I parametri di input sono la matricola e l'ID del corso di studi di uno studente. 
In questa attività vengono eseguite le azioni: Registrazione, Scrittura esame, Correzione.
Il risultato dell'attività è un voto. In questo diagramma non viene mostrato chi esegue tale azione.

## Azioni
Gli elementi di base delle attività sono le azioni. Proprio come un'attività, un'azione è rappresentata come un rettangolo con angoli arrotondati, con il nome dell'azione posizionato al centro del rettangolo.
- Le azioni possono essere utilizzzate per specificare qualsiasi comportamento definito dall'utente. È possibile definire azioni in linguaggio naturale o usando un linguaggio di programmazione.
- Le azioni elaborano valori di input per produrre valori di output, il che significa che sono in grado di eseguire calcoli.
- Possono anche caricare dati da una memoria e modificare lo stato corrente di un sistema.

Nel contesto di un'attività, le azioni sono **sempre atomiche**, cioè non possono essere suddivise ulteriormente all'interno del contesto modellato.
Tuttavia, un'azione può riferirsi a un'altra attività che a sua volta è composta da azioni. Le azioni sono considerate atomiche, anche se possono essere composta da più fasi individuali, come l'accesso al sistema e la selezione del corso appropriato e della data dell'esame.

Le azioni e i parametri sono collegati tra loro tramite archi diretti. Questi archi esprimono l'ordine di esecuzione delle azioni e definiscono quindi le fasi di esecuzione di un'attività. 
- Gli archi di flusso di controllo definiscono solo l'ordine tra le azione.

Ciò consente di esprimere una dipendenza dai dati tra un'azione precedente e una successiva. Il completamento di un'azione può avviare l'esecuzione di un'altra azione se queste due azioni sono collegate tra loro trami archi di flusso di controllo.
Tuttavia, un'azione può essere eseguita se tutte le guardie pertinenti sono verificate e se tutti i parametri di ingresso hanno un valore.
Le guardie sono condizioni che devono essere soddisfatte per consentire la transizione da un'attività/azione a un'altra attività/azione. Di solito sono collegate a rami alternativi. 

### Azioni basate sugli eventi (event-based)
Le azioni basate sugli eventi consentono di trasmettere oggetti e segnali a oggetti riceventi. Permettono di distinguere diversi tipi di eventi. 
- È possibile utilizzare un'azione di accettazione di eventi per modellare un'azione che attende il verificarsi di un'evento specifico. Viene rappresentata con un pentagono concavo con la base minore rivolta verso destra.
- Se l'evento è di tipo temporale, è possibile utilizzare un'azione di accettazione di eventi temporali. Viene rappresentata con una clessidra.

Le azioni di accettazione di eventi (temporali) non hanno necessariamente archi in entrata. 
- Se non hanno archi in entrata, iniziano quando si verifica l'evento corrispondente. Rimangono attive, cioè possono ricevere segnali finché l'attività che le contiene non termina.
![[exEventBased.png]]
(a) ogni volta che scatta l'allarme anticendio, l'aula deve essere evacuata.
(b) alla fine di un semestre vengono rilasciati dei certificati.
(c) quando uno studente ha sostenuto un esame, attende il voto ed ispeziona il compito quando riceve il voto.

Per inviare segnali, è possibile utilizzare le azioni di invio dei segnali. Le azioni di invio dei segnali sono indicate con un pentagono convesso con la punta rivolta verso destra.

## Control flows
Le attività sono costituite da altre attività e azioni collegate tra loro da archi. Per integrare gli aspetti del comportamento dinamico del diagramma, abbiamo bisogno di una semantica d'esecuzione, cioè un modo di specificare esattamente come deve essere eseguito un diagramma delle attività.
### Token
Il concetto di token sta alla base della semantica di esecuzione del diagramma delle attività. Un token è un meccanismo di coordinamento virtuale che descrive esattamente l'esecuzione. In questo contesto, "virtuale" significa che i token non sono componenti fisici del diagramma. Sono meccanismi che concedono alle azioni un permesso di esecuzione.
- Se un'azione riceve un token $\implies$ è attiva e può essere eseguita. 
- Una volta terminata, l'azione passa il token a un nodo successivo tramite un arco, innescando così l'esecuzione di quell'azione.
- Una volta terminata, l'azione passa il token agli archi in uscita o lo mantiene fino a quando non viene soddisfatta una cerca condizione.
### Nodi di controllo
Il diagramma delle attività offre nodi speciali per controllare il flusso di controllo. Questi nodi sono chiamati nodi di controllo.
#### Nodo iniziale
Il nodo iniziale indica il punto in cui inizia l'esecuzione di un'attività.
- Non ha archi in entrata
- Ha almeno un arco in uscita
- Viene rappresentato da un cerchio pieno
- Non appena un'attività diventa attiva, vengono forniti dei token su tutti gli archi in uscita di un nodo iniziale $\implies$ l'attività viene avviata.

![[exNodoIniz.png]]

L'esempio mostra un diagramma che contiene un nodo iniziale e un nodo finale dell'attività, contrassegnato da un cerchio bianco e nero.

Per ogni attività sono consentiti più nodi iniziali; questo permette di esprimere la concorrenza, cioè che più percorsi possono essere attivi contemporaneamente.
- Se viene chiamata un'attività con più nodi iniziali, gli archi in uscita di tutti i nodi iniziali ricevono contemporaneamente i token.

![[exNodiIniz.png]]

L'esempio mostra due sottopercorsi contemporanei dell'attività Conduci lezione. Quando Conduci lezione viene attività, un token viene collocato in ciascuno dei due nodi iniziali e quindi entrambi i sottopercorsi vengono attivati. Un sottopercorso riguarda le azioni degli studenti e l'altro sottopercorso si riferisce alle aszioni eseguite da un docente.
Nell'azione Scrivi esame, entrambi i percorsi vengono mergiati (uniti). Affinché l'azione Scrivere esame venga eseguita, deve essere presente un token su entrambi gli archi in entrata.

#### Nodi di decisione (scelta)
È possibile modellare rami alternativi utilizzando nodi di decisione. Fungono da switch point per i token e corrispondono agli if statement di un linguaggio di programmazione. 
- Un nodo di decisione è rappresentato come un diamante con un arco in entrata e più archi in uscita.
- Gli archi in uscita hanno delle guardie (chiamate condizioni), espressioni booleane tra parentesi quadre.
	- Le condizioni non devono sovrapporsi; il sistema deve essere in grado di decidere chiaramente quale arco di uscita deve prendere un token in una situazione specifica.
- Se c'è un token in un nodo di scelta, il sistema deve essere in grado di decidere chiaramente, in base al contesto corrente, quale percorso deve seguire il token per uscire dal nodo di decisione.

![[exScelta.png]]

Se l'azione Register viene eseguita: se ci sono ancora posti disponibili allora viene seguita dall'azione Select group, altrimenti viene eseguita l'azione Enter on waiting list.

#### Nodo di fusione (merge)
Se si vuole ricongiungere i sottopercorsi alternativi è possibile farlo con il nodo merge.
- Nodo a diamante con più archi in entrata e un solo arco in uscita. 
- Un token può essere presente al massimo su un arco in entrata.

Utilizzando i nodi decisionali e di merge è possibile modellare i loop.

![[exLoop.png]]

È possibile combinare i nodi di decisione e di merge, formando un nodo con più archi in entrata e più archi in uscita. 

### Uso della concorrenza

![[exConcorrenza.png]]

#### Nodo di fork
Se un percorso di esecuzione si divide in più percorsi di esecuzione simultaneamente attivi in un secondo momento, è possibile realizzare questo fatto utilizzando un nodo fork.
- Rappresentato da una barra nera con un arco in entrata e più archi in uscita.

Nell'esempio sopra, una volta Registrato a un corso, lo studente assiste alla lezione e partecipa contemporaneamente al compito. Lo studente può scrivere l'esame solo quando ha completato sia la lezione che il compito.

#### Nodo join
È possibile unire sottopercorsi concorrenti utilizzando un nodo di join. Questo nodo è la controparte della fork.
- Rappresentato come una barra nera con più archi in entrata ma un solo arco in uscita. Non appena i token sono presenti su tutti gli archi in entrata (tutte le azioni precedenti sono state eseguite) tutti i token in entrata vengono fusi in un unico token che viene passato sull'arco in uscita.

n.b Non è necessaria una join per ogni fork.

#### Nodo di fine attività
Per esprimere la fine di un'attività, il diagramma delle attività offre il nodo di fine attività. 
- Rappresentato come un cerchio bianco e nero (occhio di bue). 

Se un token è presente su un arco in entrata di un nodo di fine attività $\implies$ l'intera attività viene terminata, cioè tutte le azioni attive di questa attività vengono terminate.
- Questo include sottopercorsi contemporanei attivi, quindi tutti i token dell'attività vengono cancellati.

Se un diagramma contiene più nodi di fine attività, il primo raggiunto durante l'esecuzione termina l'intera attività. È possibile unire più nodi finali di attività in un unico nodo finale di attività con più archi in entrata. Non appena un token raggiunge il nodo finale dell'attività tramite un arco in entrata, l'intera attività viene terminata.

#### Nodo di fine flusso
Se si vuole terminare solo un percorso di esecuzione, lasciando inalterati gli altri percorsi di esecuzione concordemente attivi, si deve usare il nodo di fine flusso. 
- Questo nodo cancella solo i token che vi confluiscono direttamente, terminando così solo il rispettivo percorso.
- Tutti gli altri token dell'attività rimangono inalterati e possono continuare a esistere.
- Il nodo di fine flusso è rappresentato da un cerchio con una X dentro.
	- Ha solo archi in entrata.

### Sotto-attività
Un'azione può includere (chiamare) un'altra attività, descritta in un diagramma a parte per migliorare leggibilità e favorire il riuso.
- Viene rappresentato da un rettangolo con gli angoli arrotondati e un rastrello in basso a destra.

### Partizioni
Una partizione permette di raggruppare nodi e archi di un'attività in base a proprietà comuni.

![[exPartizioni.png]]

Spesso corrisponde alla divisione in unità operative in un modello di business. Permettono di assegnare la responsabilità delle azioni.



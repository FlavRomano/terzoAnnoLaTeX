1. From the following tables, write a SQL query to find all the orders issued by the salesman 'Paul Adam'. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

```sql
Salesman:
salesman_id  name        city        commission
-----------  ----------  ----------  ----------
5001         James Hoog  New York    0.15
5002         Nail Knite  Paris       0.13
5005         Pit Alex    London      0.11
5006         Mc Lyon     Paris       0.14
5003         Lauson Hen  San Jose    0.12
5007         Paul Adam   Rome        0.13

Orders:
ord_no      purch_amt   ord_date    customer_id  salesman_id
----------  ----------  ----------  -----------  -----------
70001       150.5       2012-10-05  3005         5002
70009       270.65      2012-09-10  3001         5005
70002       65.26       2012-10-05  3002         5001
70004       110.5       2012-08-17  3009         5003
70007       948.5       2012-09-10  3005         5002
70005       2400.6      2012-07-27  3007         5001
70008       5760        2012-09-10  3002         5001
70010       1983.43     2012-10-10  3004         5006
70003       2480.4      2012-10-10  3009         5003
70012       250.45      2012-06-27  3008         5002
70011       75.29       2012-08-17  3003         5007
70013       3045.6      2012-04-25  3002         5001
```

Soluzione:
```sql
select
	ord_no, purch_amt, ord_date, customer_id, salesman_id
from
	Orders
where
	Orders.salesman_id = (select salesman_id from Salesman where name='Paul Adam');
```

1. From the Salesman-Orders tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

Soluzione:
```sql
select
	ord_no, purch_amt, ord_date, customer_id, salesman_id
from 
	Orders
where 
	Orders.salesman_id in (select salesman_id from Salesman where city = 'London');
```

1. From the Salesman-Orders tables write a SQL query to find all orders generated by the salespeople who may work for customers whose id is 3007. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

soluzione:
```sql
select
	*
from
	Orders
where
	Orders.salesman_id = (select distinct salesman_id from orders where customer_id=3007)
```

1. From the Salesman-Orders tables write a SQL query to find the order values greater than the average order value of 10th October 2012. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```sql
select
	*
from 
	Orders
where
	purch_amt > (
		select
			avg(purch_amt)
		from
			Orders
		where
			ord_date = '2012-10-10'
	);
```

1. From the Salesman-Orders tables, write a SQL query to find all the orders generated in New York city. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

soluzione:
```sql
select
	*
from
	Orders
where
	salesman_id in (
		select
			salesman_id
		from
			Salesman
		where 
			city = 'New York'
	)
```

1. From the Salesman-Customer tables, write a SQL query to determine the commission of the salespeople in Paris. Return commission.
```sql
Salesman:
salesman_id  name        city        commission
-----------  ----------  ----------  ----------
5001         James Hoog  New York    0.15
5002         Nail Knite  Paris       0.13
5005         Pit Alex    London      0.11
5006         Mc Lyon     Paris       0.14
5003         Lauson Hen  San Jose    0.12
5007         Paul Adam   Rome        0.13

Customer:
 customer_id |   cust_name    |    city    | grade | salesman_id 
-------------+----------------+------------+-------+-------------
        3002 | Nick Rimando   | New York   |   100 |        5001
        3007 | Brad Davis     | New York   |   200 |        5001
        3005 | Graham Zusi    | California |   200 |        5002
        3008 | Julian Green   | London     |   300 |        5002
        3004 | Fabian Johnson | Paris      |   300 |        5006
        3009 | Geoff Cameron  | Berlin     |   100 |        5003
        3003 | Jozy Altidor   | Moscow     |   200 |        5007
        3001 | Brad Guzan     | London     |       |        5005
```

soluzione:
```sql
select
	commission
from
	Salesman
where
	salesman_id in (
		select
			salesman_id
		from 
			Customer
		where
			city = 'Paris'
	)
```

1. From the Salesman-Customer tables, write a query to display all the customers whose ID is 2001 below the salesperson ID of Mc Lyon.

soluzione
```sql
select
	*
from
	Customers
where 
	customer_id = (
		select
			salesman_id - 2001 as salesman_id
		from
			Salesman
		where
			name = 'Mc Lyon'
	)
```

1. From the Customer table, write a SQL query to count the number of customers with grades above the average in New York City. Return grade and count.

```sql
select
	grade, count(*) as cnt
from
	Customer
where
	grade > (select avg(grade) from Customer where city = 'New York');
```

1. From the Orders-Salesman-Customer table, write a SQL query to find those salespeople who earned the maximum commission. Return ord_no, purch_amt, ord_date, and salesman_id.

soluzione
```sql
select
	*
from
	Orders
where 
	salesman_id in (
		select
			salesman_id
		from
			Salesman
		where
			commission = (select max(commission) from Salesman)
	)
```

1. From Orders-Customer tables, write SQL query to find the customers who placed orders on 17th August 2012. Return ord_no, purch_amt, ord_date, customer_id, salesman_id and cust_name.

soluzione
```sql
select
	Orders.*,  Customer.cust_name
from
	Orders, Customer
where
	Orders.customer_id = Customer.customer_id
	and Orders.ord_date = '2012-08-17';
```

1.  From Orders-Customer tables, write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.

soluzione:
```sql
select
	salesman_id, name
from
	Salesman
where
	salesman_id in (
		select
			salesman_id
		from
			Customer
		group by
			salesman_id
		having
			count(salesman_id) > 1
	);
```

1. From the Orders-Customer tables write a SQL query to find those orders, which are higher than the average amount of the orders. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

soluzione:
```sql
select
	*
from
	Orders O1
where 
	purch_amt > (select avg(purch_amt) from Orders where customer_id = O1.customer_id);
```

1. From the Orders-Customer tables, write a SQL query to find the sums of the amounts from the orders table, grouped by date, and eliminate all dates where the sum was not at least 1000.00 above the maximum order amount for that date.

```sql
select
	ord_date, sum(purch_amt)
from
	Orders O1
group by
	ord_date
having 
	sum(purch_amt) > (
		select 
			1000 + max(purch_amt) 
		from 
			Orders 
		where 
			O1.ord_date = Orders.ord_date
	);
```

1. Write a query to extract all data from the customer table if and only if one or more of the customers in the customer table are located in London.

soluzione
```sql
select 
	*
from
	Customer
where
	exists (
		select
			*
		from
			Customer
		where
			city = 'London'
	)
```

1. From the Customer-Salesman tables write a SQL query to find salespeople who deal with multiple customers. Return salesman_id, name, city and commission.

soluzione
```sql
select
	*
from 
	Salesman
where
	salesman_id in (
		select 
			salesman_id
		from
			Customer
		group by
			salesman_id
		having
			count(salesman_id) > 1
	)
```

1. From the Customer-Salesman tables write a SQL query to find salespeople who deal with a single customer. Return salesman_id, name, city and commission.

soluzione
```sql
select
	*
from
	Salesman
where
	1 = (
		select
			count(customer_id)
		from 
			Customer
		where
			Salesman.salesman_id = Customer.salesman_id
	)
```

1. From the Customer-Salesman-Orders tables, write a SQL query to find the salespeople who deal the customers with more than one order. Return salesman_id, name, city and commission.

soluzione
```sql
select
	*
from
	Salesman
where
	salesman_id in (
		select
			salesman_id
		from
			Customer
		where
			1 < (
				select
					count(customer_id)
				from
					Orders
				where
					Orders.customer_id = Customer.customer_id
				group by
					customer_id
			)
	)
```

1. From Salesman-Customer tables write a SQL query to find the salespeople who deal with those customers who live in the same city. Return salesman_id, name, city and commission.

soluzione
```sql
select
	*
from
	Salesman S
where
	salesman_id in (
		select
			salesman_id
		from 
			Customer C
		where
			S.city = C.city
	);
```

1. From the Salesman-Customer tables write a SQL query to find salespeople whose place of residence matches any city where customers live. Return salesman_id, name, city and commission.

soluzione
```sql
select
	*
from
	Salesman
where
	city = any(select city from Customer)
```

1. From the Customer table write a SQL query to find all those customers with a higher grade than all the customers alphabetically below the city of New York. Return customer_id, cust_name, city, grade, salesman_id.

soluzione
```sql
select
	*
from
	Customer
where
	grade > any (
		select
			grade
		from
			Customer
		where
			city < 'New York'
	);

-- Commento sull'uso dell'any (preso da w3resource)
# The above SQL query is selecting all columns (*) from the table 'customer' where the 
# "grade" value of the row is greater than any of the "grade" values in the subquery.
# The subquery is also selecting the "grade" column from the 'customer' table, 
# but only for rows where the "city" value is less than 'New York'.  
# The ANY keyword is used to check if there is any value in the subquery that 
# the outer query's condition is true for.
```

1. From the Orders table write a SQL query to find all those orders whose order amount exceeds at least one of the orders placed on September 10th 2012. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

soluzione
```sql
select
	*
from
	Orders
where
	purch_amt > any(
		select
			purch_amt
		from
			Orders
		where
			ord_date = '2012-09-10'
	);
```

1. From the Orders-Customers tables write a SQL query to find orders where the order amount is less than the order amount of a customer residing in London City. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

soluzione
```sql
select
	*
from
	Orders
where
	purch_amt < any(
		select
			purch_amt
		from
			Customer, Orders
		where 
			Customer.customer_id = Orders.customer_id
			and Customer.city = 'London'
	);
```

1. From the Orders-Customers tables write a SQL query to find those orders where every order amount is less than the maximum order amount of a customer who lives in London City. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

soluzione
```sql
select
	*
from 
	Orders
where
	purch_amt < (
		select
			max(purch_amt)
		from
			Customer, Orders
		where
			Customer.customer_id = Orders.customer_id
			and Customer.city = 'London'
	);
```

1. From the Customer tables write a SQL query to find those customers whose grades are higher than those living in New York City. Return customer_id, cust_name, city, grade and salesman_id.

```sql
select
	*
from
	Customer
where
	grade > all(
		select
			grade
		from
			Customer
		where
			city = 'New York'
	);
```